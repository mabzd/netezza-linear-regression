#!/bin/bash
export NZLRROOT=$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )

echo 'create str_to_table stored procedure...'
nzsql nzdb -f str_to_table.sql

echo 'create args_to_table stored procedure...'
nzsql nzdb -f args_to_table.sql

echo 'create create_csv_table stored procedure...'
nzsql nzdb -f create_csv_table.sql

echo 'compile XTXMatrixUdtf udtf...'
nzudxcompile --sig "XTXMatrix(varargs)" --return "TABLE(x int, y int, value double)" --class XTXMatrixUdtf --version 2 XTXMatrixUdtf.cpp --user nzu --pw 12345 --db nzdb --lastcall "TABLE FINAL"

echo 'compile SqMatrixPadUdf udf...'
nzudxcompile --sig "SqMatrixPad(int, int, int, double)" --return "BOOL" --class SqMatrixPadUdf --version 2 SqMatrixPadUdf.cpp --user nzu --pw 12345 --db nzdb --unfenced --nondet

echo 'compile InvSqMatrixPadUdf udf...'
nzudxcompile --sig "InvSqMatrixPad()" --return "BOOL" --class InvSqMatrixPadUdf --version 2 InvSqMatrixPadUdf.cpp --user nzu --pw 12345 --db nzdb --unfenced --nondet --args "-I${NZLRROOT}/include/eigen" 

echo 'compile CalcLRBVecUdtf udtf...'
nzudxcompile --sig "CalcLRBVec(varargs)" --return "TABLE(b int, value double)" --class CalcLRBVecUdtf --version 2 CalcLRBVecUdtf.cpp --user nzu --pw 12345 --db nzdb --unfenced --lastcall "TABLE FINAL"

echo 'create linear_regression stored procedure...'
nzsql nzdb -f linear_regression.sql
